---
title: Wordpressサイトを Next.js + GitHub Actions + Netlify でリニューアルしました
---

こんにちは。ざるご ([@zalgo3](https://twitter.com/zalgo3)) です。

当サイトはもともと Wordpress で構築されており、エックスサーバーにデプロイされていました。

Wordpress サイトは、ほとんどコーディングを必要とせず始められる上に、
はてなブログや note などの既存のブログサービスを使うよりも細かい調整が効きやすい、という面で、良い点も多かったです。

しかし、UI では手の届かないような細かい調整をしようと思うと、結局コーディングが必要になるし、
そのときに無駄に PHP に手を加えないといけないのには、一定のしんどさを感じていました。

また、プラグインなどでゴリゴリ機能を追加すればするほど、サイトの表示速度が低下していくのにも辛さを感じていました。

そこで、昨今は単にリクエストに応じて静的なコンテンツを配布する[**Jamstack**](https://qiita.com/ozaki25/items/4075d03278d1fb51cc37)なる構成が
流行っているというのを聞いていたのもあって、モダンなフレームワークを使ってすべて自前でブログのシステムを作ってしまうことにしました。

具体的なフレームワークとしては、[Next.js](https://github.com/vercel/next.js/)を使っています。
Next.js は、React.js のサーバーサイドレンダリングとしては、デファクトスタンダードとなっているフレームワークです。

モダンなフロントエンドといえば React.js vs Vue.js というイメージでした。
どちらを選ぶかは迷いどころでしたが、[Stack Overflow Trends](https://insights.stackoverflow.com/trends?utm_source=so-owned&utm_medium=blog&utm_campaign=trends&utm_content=blog-link&utm_term=state-of-mobile&tags=reactjs%2Cvue.js%2Creact-native)
では React のほうが上位ということで、React.js を選択しました。

また、作ったアプリケーションの公開には、静的サイトを簡単にホスティングできるサービスである[Netlify](https://www.netlify.com)を使いました。

## 工夫した点など

細かい技術的な工夫などを話せばキリがないので、かいつまんで書きます。

### すべての記事を Markdown で書けるように

Markdown は、以下のような書きやすく読みやすい記述方式で、文章構造を表すことのできる軽量マークアップ言語です。

```markdown
## 見出し

すごく面白い文章

-   すごくためになる箇条書き 1
-   すごくためになる箇条書き 2
```

Markdown は、はてなブログなどの大手ブログサービスでもサポートされており、サクッと文章を書くのには本当に便利な記述形式です。

このブログでは、`next-mdx-remote`というパッケージを使い、
[`posts/[slug]/post.md`という名前の Markdown を記事ごとに配置する](https://github.com/zalgo3/zalgo-official.com/tree/main/posts)だけで、
ブログ記事が生成されるという仕組みを採用しています。

こうすることで、新しい記事を公開したり編集したりするためだけに、いちいち TypeScript のソースコードを編集する必要はなくなります。

### 数式やソースコードの表示に対応

`rehype-prism`や、`rehype-math`, `rehype-katex`などのパッケージを使うことで、先程の Markdown ファイルの中に

```markdown
-   `print("Hello World.")`
-   $f(x) = 0$
```

などと書くと、

-   `print("Hello World.")`
-   $f(x) = 0$

などと、ソースコードや数式が表示されるようにしました。

### GitHub Actions によるビルド →Netlify へのデプロイ

Netlify には、GitHub リポジトリと連携するだけで、Next.js のビルドをする仕組みがもともと提供されています。

基本的にはその機能を使えば十分なのですが、今回は、GitHub Actions でビルドをしてから、Netlify CLI をつかって Netlify にサイトをデプロイする仕組みを採用しています。

なぜなら、Netlify では、月間 300 分までのビルドは無料で行えるものの、それを超えると 500 分ごとに 7 ドルの料金が発生するためです。

GitHub Actions は、パブリックリポジトリに対しては、なんと無料でビルドを行うことができます。

どのみちソースコードは公開するつもりだったので、パブリックリポジトリであるデメリットは私には一切ありません。

これはぜひ活用させていただこうということで、ビルドは GitHub Actions、デプロイのみ Netlify を使うことにしました。

### 独自ドメイン化、Google Adsense や Google Analytics タグの配置など

もともとの Wordpress サイトでやっていたことなので、このあたりは当然と言えば当然なのですが、対応しています。

## おわりに

フロントエンドは未学習だったのですが、博士課程を卒業し、データサイエンティストとして働き始めたのもあり、
そこそこコーディングには慣れてきていたのも幸いして、なんとかある程度形にすることができたので、こうして記事を書いてお披露目をすることにしました。

まだ未完成な部分は多いものの、思い立ったらすぐ新しい機能をどんどん追加できるのは、自分でコーディングする大きな利点ですね。

基本的に静的な HTML を返すだけなので、データベースへの問い合わせなどが発生せず、表示速度が爆速なのも魅力的です。

せっかくシステムを作ったので、これを機にちょこちょこコンテンツも配置していきたいですね。あまり期待せず待っていてくださいｗ

ソースコードは https://github.com/zalgo3/zalgo-official.com で公開しています。興味のある方はどうぞ。

それではまた～
